[
  {
    "objectID": "exercise27-28.html",
    "href": "exercise27-28.html",
    "title": "Exercise27-28",
    "section": "",
    "text": "Load Packages\n\nlibrary(tidyverse)\n\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.0.4     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors\n\nlibrary(tmap)\nlibrary(terra)\n\nterra 1.8.42\n\nAttaching package: 'terra'\n\nThe following object is masked from 'package:tidyr':\n\n    extract\n\nlibrary(sf)\n\nLinking to GEOS 3.13.0, GDAL 3.8.5, PROJ 9.5.1; sf_use_s2() is TRUE\n\nlibrary(osmdata)\n\nData (c) OpenStreetMap contributors, ODbL 1.0. https://www.openstreetmap.org/copyright\n\nlibrary(units)\n\nudunits database from /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/library/units/share/udunits/udunits2.xml\n\n\n\n\nDefine River\n\nfort_collins_bbox &lt;- getbb(\"Fort Collins, Colorado\")\n\nosm_data &lt;- opq(bbox = fort_collins_bbox) %&gt;%\n  add_osm_feature(key = \"waterway\") %&gt;%\n  osmdata_sf()\n\n# Filter for Cache la Poudre River\npoudre &lt;- osm_data$osm_lines %&gt;%\n  filter(str_detect(name, \"Cache la Poudre\")) %&gt;%\n  st_union() %&gt;%\n  st_as_sf()\n\n\n\nLength\n\nriver_length &lt;- st_length(poudre)\nprint(river_length)\n\n175361.9 [m]\n\n\n\n\nConvert to Points\n\npoudre_pts &lt;- st_cast(poudre, \"POINT\")\n\n\n\nDEM objects\n\nlibrary(terra)\n\nurl &lt;- '/vsicurl/https://raw.githubusercontent.com/mikejohnson51/csu-ess-330/main/resources/foco-elev-cm.tif'\n\ndem &lt;- rast(url)\n\n\n\nRiver profile\n\nelev_vals &lt;- extract(dem, poudre_pts)\n\nWarning: [extract] transforming vector data to the CRS of the raster\n\n# Bind elevation values to point geometry\npoudre_profile &lt;- bind_cols(poudre_pts, elev_vals) %&gt;%\n  mutate(ID = row_number())\n\n\n\nStraight line distance\n\nstart_point &lt;- st_geometry(poudre_pts)[1]\nend_point &lt;- st_geometry(poudre_pts)[length(st_geometry(poudre_pts))]\n\nstraight_dist &lt;- st_distance(start_point, end_point)\nsinuosity &lt;- as.numeric(river_length) / as.numeric(straight_dist)\n\nprint(sinuosity)\n\n[1] 2.721159\n\n\n\n\nSlope\n\nvalid_profile &lt;- poudre_profile %&gt;%\n  filter(!is.na(dem))\n\nelev_inlet &lt;- valid_profile$dem[1]\nelev_outlet &lt;- valid_profile$dem[nrow(valid_profile)]\n\nriver_length_m &lt;- as.numeric(st_length(poudre))  \n\n\nslope &lt;- (elev_inlet - elev_outlet) / river_length_m\n\nslope\n\n[1] 0.02809048\n\n\n\n\nMap\n\n ggplot(poudre_profile, aes(x = ID, y = dem)) +\n  geom_line(color = \"steelblue\") +\n  labs(title = \"Elevation Profile of the Cache la Poudre River\",\n       x = \"Point ID\", y = \"Elevation (cm)\") +\n  theme_minimal()\n\nWarning: Removed 3690 rows containing missing values or values outside the scale range\n(`geom_line()`).\n\n\n\n\n\n\n\n\n\n\n\nMap of river colored by elevation\n\nggplot(poudre_profile) +\n  geom_sf(aes(color = dem)) +\n  scale_color_viridis_c(name = \"Elevation (cm)\") +\n  labs(title = \"Cache la Poudre River Profile by Elevation\") +\n  theme_minimal()"
  }
]